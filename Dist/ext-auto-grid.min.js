(function(e,t,n,r){function o(t,n){this.element=t;this.settings=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="extAutoGrid",s={showAdd:true,showDelete:true,cellEditing:true,rowEditing:false,fields:[],columns:[],validations:null,url:"#",width:500,height:300,title:"No title",addHandler:null,root:"_embedded",addBtnTitle:"Add",deleteBtnTitle:"Delete",grid:null,store:null,dockItems:null,ready:function(){}};e.extend(o.prototype,{init:function(){var t=this;Ext.require(["Ext.data.*","Ext.grid.*"]);if(t.settings.fields.length==0)e.ajax({async:false,url:this.settings.url,type:"GET",success:function(e){if(e.page.totalElements>0){}}});Ext.define("Person",{extend:"Ext.data.Model",fields:t.settings.fields,validations:t.settings.validations});Ext.onReady(function(){var e=Ext.create("Ext.data.Store",{autoLoad:true,autoSync:true,model:"Person",proxy:{type:"rest",url:t.settings.url,reader:{type:"json",root:t.settings.root,totalProperty:"page.totalElements"},writer:{type:"json",transform:{fn:function(e,t){if(t._records[0].data._links){t._records[0].data.id=null;t._url=t._records[0].data._links.self.href}return t._records[0].data},scope:this}}},pageSize:20,listeners:{write:function(e,t){if(t._response.status==201){e.reload()}}}});t.settings.store=e;var n=Ext.create("Ext.grid.plugin.RowEditing",{listeners:{cancelEdit:function(t,n){if(n.record.phantom){e.remove(n.record)}}}});var r=Ext.create("Ext.grid.plugin.CellEditing",{listeners:{cancelEdit:function(t,n){if(n.record.phantom){e.remove(n.record)}}}});var i=t.settings.showAdd?{text:t.settings.addBtnTitle,iconCls:"icon-add",handler:t.settings.addHandler?t.settings.addHandler(e,n):function(){var t=new Person;t.id=0;t.data.id=0;e.insert(0,t);n.startEdit(0,0)}}:{};var s=t.settings.showDelete?{itemId:"delete",text:t.settings.deleteBtnTitle,iconCls:"icon-delete",disabled:true,handler:function(){var t=a.getView().getSelectionModel().getSelection()[0];if(t){e.remove(t)}}}:{};var o=t.settings.showAdd||t.settings.showDelete;var u=[];if(t.settings.showAdd)u.push(i);if(t.settings.showDelete){u.push("-");u.push(s)}t.settings.dockItems=u;var a=Ext.create("Ext.grid.Panel",{renderTo:t.element,plugins:t.settings.rowEditing?[n]:t.settings.cellEditing?[r]:null,width:t.settings.width,height:t.settings.height,frame:true,title:t.settings.title,store:e,iconCls:"icon-user",columns:t.settings.columns,bbar:new Ext.PagingToolbar({pageSize:20,store:e,displayInfo:true,emptyMsg:"No results to display"}),dockedItems:o?[{xtype:"toolbar",items:u}]:false});t.settings.grid=a;if(t.settings.showDelete)a.getSelectionModel().on("selectionchange",function(e,t){a.down("#delete").setDisabled(t.length===0)});t.settings.ready(t)})},getGrid:function(){return this.settings.grid},getStore:function(){return this.settings.store},getDockItems:function(){return this.settings.dockItems}});e.fn[i]=function(t){var n=e.data(this,"plugin_"+i);this.each(function(){if(!n){n=new o(this,t);e.data(this,"plugin_"+i,n)}});return n}})(jQuery,window,document)